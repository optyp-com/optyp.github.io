---
import { faqs } from "../data/faq.js";
import FAQSearch from "./FAQSearch.astro";
---

<section class="bg-gradient-to-br from-gray-50 via-gray-100 to-gray-200 py-20 px-4" id="faq">
  <div class="container mx-auto max-w-5xl text-center">
    <h2 class="text-4xl font-extrabold mb-4 text-gray-900">Frequently Asked Questions</h2>
    <div class="w-20 h-1 bg-gradient-to-r from-primary-500 to-primary-700 mx-auto mb-10 rounded-full"></div>
    <p class="text-gray-800 mb-12 max-w-xl mx-auto text-lg font-medium">
      Quick answers to the most common questions.
    </p>

    <!-- Search Bar -->
    <div class="relative max-w-lg mx-auto mb-10">
      <input
        id="faq-search"
        type="text"
        placeholder="üîç Search FAQs..."
        class="w-full px-5 py-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
      />
    </div>

    <!-- FAQ List (Preview: first 3 only) -->
    <div id="faq-list" class="space-y-6 text-left">
      {faqs.slice(0, 3).map((faq, i) => (
        <div class="faq-item group bg-white/30 backdrop-blur-lg rounded-xl shadow-md transition hover:border-primary-500"
             data-aos="fade-up" data-aos-delay={i * 100}>
          <button class="faq-question w-full text-left p-6 font-bold text-lg text-gray-900 flex justify-between items-center"
            aria-expanded="false"
            aria-controls={`faq${i}`}
            onclick={`toggleFAQ('faq${i}', this)`}>
            <span class="faq-text">{faq.question}</span>
            <svg class="w-6 h-6 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div id={`faq${i}`} class="faq-answer max-h-0 overflow-hidden transition-all duration-500 px-6 text-gray-700 text-base">
            <p class="py-4 faq-text" set:html={faq.answer}></p>
          </div>
        </div>
      ))}
    </div>

    <!-- No Results -->
    <p id="faq-no-results" class="hidden text-gray-600 mt-8">‚ùå No FAQs found. Try a different keyword.</p>

    <!-- Redirect -->
    <div class="text-center mt-10">
      <a href="/faq" class="inline-flex items-center px-8 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:scale-105 transition">
        See More FAQs ‚Üí
      </a>
    </div>
  </div>

  <!-- Toggle Script -->
  <script is:inline>
    function toggleFAQ(faqId, button) {
      const answer = document.getElementById(faqId);
      const icon = button.querySelector('svg');
      const expanded = button.getAttribute('aria-expanded') === 'true';

      document.querySelectorAll('.faq-answer').forEach(el => el.style.maxHeight = '0');
      document.querySelectorAll('.faq-question').forEach(btn => {
        btn.setAttribute('aria-expanded', 'false');
        btn.querySelector('svg').style.transform = 'rotate(0deg)';
      });

      if (!expanded) {
        answer.style.maxHeight = answer.scrollHeight + 'px';
        button.setAttribute('aria-expanded', 'true');
        icon.style.transform = 'rotate(180deg)';
      }
    }
  </script>

  <!-- Reusable Search -->
  <FAQSearch inputId="faq-search" listId="faq-list" noResultsId="faq-no-results" />
</section>
