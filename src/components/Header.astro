---
// src/components/Header.astro
---
<header id="site-header" class="bg-transparent sticky top-0 z-50 transition-all duration-500">
  <div class="container mx-auto flex items-center justify-between px-4 py-3">
    <!-- Logo -->
    <a href="/" class="flex items-center space-x-3" aria-label="OPTYP home">
      <img src="/images/logo.svg" alt="OPTYP Logo" class="h-10 w-auto" />
      <span class="font-bold text-xl tracking-wide text-white">OPTYP</span>
    </a>

  <!-- âœ… Canonical link -->
  <link rel="canonical" href={canonicalUrl} />

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-button"
      class="md:hidden focus:outline-none focus:ring-2 focus:ring-cyan-400 rounded"
      aria-label="Toggle Menu"
      aria-expanded="false"
    >
      <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" stroke-width="2"
        viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <line x1="3" y1="12" x2="21" y2="12" />
        <line x1="3" y1="6" x2="21" y2="6" />
        <line x1="3" y1="18" x2="21" y2="18" />
      </svg>
    </button>

    <!-- Desktop Navigation -->
    <nav class="hidden md:flex items-center space-x-6 font-semibold text-gray-200" role="navigation" aria-label="Primary">
      <a href="/#hero" class="nav-link" data-section="hero">Home</a>
      <a href="/about" class="nav-link" data-section="about">About</a>
      <a href="/services" class="nav-link" data-section="services">Services</a>
      <a href="/contact" class="nav-link" data-section="contact">Contact</a>

      <!-- ðŸ”½ Explore Dropdown -->
      <li class="relative list-none">
        <button 
          id="explore-toggle" 
          class="nav-link flex items-center gap-1"
          aria-haspopup="true" aria-expanded="false"
        >
          Explore
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M5 7l5 5 5-5H5z" /></svg>
        </button>
        <div 
          id="explore-menu"
          class="absolute right-0 mt-2 hidden bg-black/90 text-white rounded-md shadow-lg w-56 z-50 transition-all duration-300 ease-out transform opacity-0 -translate-y-2"
        >
          <ul class="py-2">
            <li><a href="/explore/ats-resume" class="block px-4 py-2 hover:bg-white/10">ATS Resume</a></li>
            <li><a href="/explore/linkedin" class="block px-4 py-2 hover:bg-white/10">LinkedIn Optimization</a></li>

            <!-- Job Portals submenu -->
            <li class="relative">
              <button class="submenu-toggle w-full text-left px-4 py-2 hover:bg-white/10 flex items-center justify-between">
                Job Portals
                <svg class="w-4 h-4"><path d="M7 5l5 5-5 5V5z"/></svg>
              </button>
              <ul class="submenu hidden bg-black/90 rounded-md shadow-lg w-48 ml-2 mt-1 transition-all duration-300 ease-out transform opacity-0 -translate-y-2">
                <li><a href="/explore/job-portals/naukri" class="block px-4 py-2 hover:bg-white/10">Naukri</a></li>
                <li><a href="/explore/job-portals/indeed" class="block px-4 py-2 hover:bg-white/10">Indeed</a></li>
              </ul>
            </li>

            <!-- Freelancing submenu -->
            <li class="relative">
              <button class="submenu-toggle w-full text-left px-4 py-2 hover:bg-white/10 flex items-center justify-between">
                Freelancing
                <svg class="w-4 h-4"><path d="M7 5l5 5-5 5V5z"/></svg>
              </button>
              <ul class="submenu hidden bg-black/90 rounded-md shadow-lg w-48 ml-2 mt-1 transition-all duration-300 ease-out transform opacity-0 -translate-y-2">
                <li><a href="/explore/freelancing/fiverr" class="block px-4 py-2 hover:bg-white/10">Fiverr</a></li>
                <li><a href="/explore/freelancing/upwork" class="block px-4 py-2 hover:bg-white/10">Upwork</a></li>
                <li><a href="/explore/freelancing/toptal" class="block px-4 py-2 hover:bg-white/10">Toptal</a></li>
              </ul>
            </li>

            <li><a href="/explore/github" class="block px-4 py-2 hover:bg-white/10">GitHub Optimization</a></li>
            <li><a href="/explore/portfolio-site" class="block px-4 py-2 hover:bg-white/10">Portfolio Website</a></li>
            <li><a href="/explore/personal-branding" class="block px-4 py-2 hover:bg-white/10">Personal Branding</a></li>
          </ul>
        </div>
      </li>

      <!-- CTA -->
      <button
        id="header-cta"
        class="ml-2 glass-btn px-4 py-2 rounded-lg text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-cyan-400"
        aria-haspopup="dialog"
        aria-controls="contact-modal"
      >
        Get Started
      </button>
    </nav>
  </div>

  <!-- Mobile Navigation -->
  <nav id="mobile-menu"
       class="md:hidden fixed inset-x-4 top-16 bg-black/70 backdrop-blur-md border border-white/6 rounded-xl shadow-lg hidden p-4 space-y-2 font-semibold text-white z-50"
       aria-hidden="true"
  >
    <a href="/#hero" class="nav-link block py-2 px-3 rounded-md">Home</a>
    <a href="/#about" class="nav-link block py-2 px-3 rounded-md">About</a>
    <a href="/#services" class="nav-link block py-2 px-3 rounded-md">Services</a>
    <a href="/#contact" class="nav-link block py-2 px-3 rounded-md">Contact</a>

    <!-- ðŸ”½ Explore Mobile -->
    <details class="px-3 py-2 rounded-md bg-white/5">
      <summary class="cursor-pointer">Explore</summary>
      <ul class="ml-4 mt-2 space-y-1">
        <li><a href="/explore/ats-resume" class="block">ATS Resume</a></li>
        <li><a href="/explore/linkedin" class="block">LinkedIn Optimization</a></li>
        <li>
          <details>
            <summary>Job Portals</summary>
            <ul class="ml-4 mt-1 space-y-1">
              <li><a href="/explore/job-portals/naukri" class="block">Naukri</a></li>
              <li><a href="/explore/job-portals/indeed" class="block">Indeed</a></li>
            </ul>
          </details>
        </li>
        <li>
          <details>
            <summary>Freelancing</summary>
            <ul class="ml-4 mt-1 space-y-1">
              <li><a href="/explore/freelancing/fiverr" class="block">Fiverr</a></li>
              <li><a href="/explore/freelancing/upwork" class="block">Upwork</a></li>
              <li><a href="/explore/freelancing/toptal" class="block">Toptal</a></li>
            </ul>
          </details>
        </li>
        <li><a href="/explore/github" class="block">GitHub Optimization</a></li>
        <li><a href="/explore/portfolio-site" class="block">Portfolio Website</a></li>
        <li><a href="/explore/personal-branding" class="block">Personal Branding</a></li>
      </ul>
    </details>

    <button id="mobile-cta" class="w-full glass-btn text-center px-4 py-2 rounded-md font-semibold mt-2" aria-haspopup="dialog" aria-controls="contact-modal">
      Get Started
    </button>
  </nav>

  <!-- Script -->
  <script is:inline>
    // Elements
    const button = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    const header = document.getElementById('site-header');
    const navLinks = Array.from(document.querySelectorAll('.nav-link'));
    const headerCTA = document.getElementById('header-cta');
    const mobileCTA = document.getElementById('mobile-cta');
    const sections = Array.from(document.querySelectorAll('section[id]'));

    // Mobile toggle
    function toggleMobileMenu() {
      const expanded = button.getAttribute('aria-expanded') === 'true';
      if (expanded) {
        menu.classList.add('hidden');
        menu.setAttribute('aria-hidden', 'true');
        button.setAttribute('aria-expanded', 'false');
      } else {
        menu.classList.remove('hidden');
        menu.setAttribute('aria-hidden', 'false');
        button.setAttribute('aria-expanded', 'true');
        const first = menu.querySelector('.nav-link');
        if (first) first.focus();
      }
    }
    button?.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMobileMenu();
    });

    document.addEventListener('click', (e) => {
      if (!menu.classList.contains('hidden') && !e.target.closest('#mobile-menu') && !e.target.closest('#mobile-menu-button')) {
        menu.classList.add('hidden');
        menu.setAttribute('aria-hidden', 'true');
        button.setAttribute('aria-expanded', 'false');
      }
    });

    // Scrollspy
    function setActive(sectionId) {
      navLinks.forEach(link => {
        const target = (link.dataset && link.dataset.section) || (link.getAttribute('href') || '').split('#')[1];
        if (target === sectionId) {
          link.classList.add('text-cyan-300','font-bold','bg-white/2','border-b-0');
        } else {
          link.classList.remove('text-cyan-300','font-bold','bg-white/2','border-b-0');
        }
      });
    }
    try {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) setActive(entry.target.id);
        });
      }, { threshold: 0.6 });
      sections.forEach(section => observer.observe(section));
    } catch (err) {}

    // Smooth scroll + modal contact
    function handleNavClick(e, link) {
      const href = link.getAttribute('href') || '';
      const hash = href.includes('#') ? href.split('#')[1] : null;
      if (hash === 'contact') {
        e.preventDefault();
        if (typeof openContactForm === 'function') openContactForm();
        else {
          const el = document.getElementById('contact');
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        if (!menu.classList.contains('hidden')) { menu.classList.add('hidden'); button.setAttribute('aria-expanded','false'); }
        return;
      }
      if (hash) {
        const target = document.getElementById(hash);
        if (target) {
          e.preventDefault();
          const top = target.getBoundingClientRect().top + window.pageYOffset - 70;
          window.scrollTo({ top, behavior: 'smooth' });
        }
      }
      if (!menu.classList.contains('hidden')) {
        menu.classList.add('hidden');
        button.setAttribute('aria-expanded','false');
      }
    }
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => handleNavClick(e, link));
      link.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          handleNavClick(ev, link);
        }
      });
    });

    function attachCTAOpen(btn) {
      if (!btn) return;
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        if (typeof openContactForm === 'function') openContactForm();
        else {
          const el = document.getElementById('contact');
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        if (!menu.classList.contains('hidden')) {
          menu.classList.add('hidden');
          button.setAttribute('aria-expanded','false');
        }
      });
    }
    attachCTAOpen(headerCTA);
    attachCTAOpen(mobileCTA);

    function updateHeaderOnScroll() {
      const sc = window.scrollY || window.pageYOffset;
      if (sc > 50) {
        header.classList.add('bg-black/70','backdrop-blur-sm','shadow-lg','border-b','border-white/6');
        header.classList.remove('bg-transparent');
      } else {
        header.classList.remove('bg-black/70','backdrop-blur-sm','shadow-lg','border-b','border-white/6');
        header.classList.add('bg-transparent');
      }
    }
    window.addEventListener('scroll', updateHeaderOnScroll, { passive: true });
    updateHeaderOnScroll();

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (!menu.classList.contains('hidden')) {
          menu.classList.add('hidden');
          button.setAttribute('aria-expanded','false');
        }
      }
    });

    // Explore dropdown toggle (desktop) with animation
    const exploreToggle = document.getElementById("explore-toggle");
    const exploreMenu = document.getElementById("explore-menu");
    exploreToggle?.addEventListener("click", (e) => {
      e.stopPropagation();
      const isOpen = exploreMenu.classList.contains("block");
      document.querySelectorAll("#explore-menu").forEach(m => m.classList.add("hidden","opacity-0","-translate-y-2"));
      if (!isOpen) {
        exploreMenu.classList.remove("hidden","opacity-0","-translate-y-2");
        exploreMenu.classList.add("block","opacity-100","translate-y-0");
        exploreToggle.setAttribute("aria-expanded", "true");
      } else {
        exploreMenu.classList.add("hidden","opacity-0","-translate-y-2");
        exploreMenu.classList.remove("block","opacity-100","translate-y-0");
        exploreToggle.setAttribute("aria-expanded", "false");
      }
    });
    document.addEventListener("click", (e) => {
      if (!exploreMenu.contains(e.target) && !exploreToggle.contains(e.target)) {
        exploreMenu.classList.add("hidden","opacity-0","-translate-y-2");
        exploreMenu.classList.remove("block","opacity-100","translate-y-0");
        exploreToggle.setAttribute("aria-expanded", "false");
      }
    });

    // Submenu toggles with animation
    document.querySelectorAll(".submenu-toggle").forEach(btn => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const submenu = btn.nextElementSibling;
        const isOpen = submenu.classList.contains("block");
        document.querySelectorAll(".submenu").forEach(s => s.classList.add("hidden","opacity-0","-translate-y-2"));
        if (!isOpen) {
          submenu.classList.remove("hidden","opacity-0","-translate-y-2");
          submenu.classList.add("block","opacity-100","translate-y-0");
        } else {
          submenu.classList.add("hidden","opacity-0","-translate-y-2");
          submenu.classList.remove("block","opacity-100","translate-y-0");
        }
      });
    });
  </script>

  <style>
    .nav-link {
      padding: 0.25rem 0.5rem;
      border-radius: 0.35rem;
      color: #e6eef1;
      transition: all 0.2s ease;
      outline: none;
    }
    .nav-link:focus {
      box-shadow: 0 0 0 3px rgba(0,255,204,0.08);
    }
    .nav-link:hover {
      color: #00ffd1;
      text-shadow: 0 0 8px rgba(0,255,204,0.12);
      transform: translateY(-1px);
    }
    .glass-btn {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      color: #00ffd1;
      backdrop-filter: blur(6px);
      transition: all 0.18s ease;
    }
    .glass-btn:hover {
      background: rgba(0,255,204,0.06);
      box-shadow: 0 6px 22px rgba(0,255,204,0.08);
      color: #fff;
      transform: translateY(-2px);
    }
    @media (max-width: 767px) {
      #mobile-menu { left: 0.5rem; right: 0.5rem; top: 4rem; }
      #mobile-menu a.nav-link { display: block; width: 100%; }
    }
  </style>
</header>
