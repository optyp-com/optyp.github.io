let f=null;document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("contact-form"),v=document.getElementById("submit-btn"),h=document.getElementById("btn-text"),E=document.getElementById("btn-spinner"),L=document.getElementById("toast"),l=document.getElementById("toast-content"),w=document.getElementById("toast-message"),S=document.getElementById("toast-icon"),g=document.getElementById("profession"),p=document.getElementById("experience-wrapper"),i=document.getElementById("experience"),b=document.getElementById("services"),B=document.getElementById("post-actions");function c(e,t){if(!e)return;const s=e.closest("div"),o=s?s.querySelector(".field-error"):null;o&&(o.textContent=t,o.classList.remove("hidden")),e.classList.add("border-red-500")}function d(e){if(!e)return;const t=e.closest("div"),s=t?t.querySelector(".field-error"):null;s&&(s.textContent="",s.classList.add("hidden")),e.classList.remove("border-red-500")}function I(){n.querySelectorAll("input, select, textarea").forEach(t=>d(t))}function y(e,t="success"){const s={success:"bg-green-600 text-white",error:"bg-red-600 text-white",warning:"bg-yellow-600 text-white"},o={success:"✅",error:"❌",warning:"⚠️"};w.textContent=e,l.className=`flex items-center gap-3 px-6 py-4 rounded-lg shadow-lg font-medium transition transform ${s[t]}`,S.textContent=o[t],L.classList.remove("hidden"),requestAnimationFrame(()=>{l.classList.remove("opacity-0","translate-y-5"),l.classList.add("opacity-100","translate-y-0")}),setTimeout(()=>{l.classList.remove("opacity-100","translate-y-0"),l.classList.add("opacity-0","translate-y-5"),setTimeout(()=>{L.classList.add("hidden")},300)},3e3)}g.addEventListener("change",()=>{g.value==="salaried"?(p.classList.remove("hidden"),i.setAttribute("required","true")):(p.classList.add("hidden"),i.removeAttribute("required"),i.value="",d(i)),d(g)});function q(){let e=!0;I();const t=n.querySelector('[name="name"]'),s=n.querySelector('[name="email"]'),o=n.querySelector('[name="phone"]'),m=n.querySelector('[name="profession"]'),r=n.querySelector('[name="message"]');return t.value.trim()||(c(t,"Full name is required"),e=!1),s.value.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value.trim())||(c(s,"Please enter a valid email"),e=!1):(c(s,"Email is required"),e=!1),o.value.trim()?/^[\\+]?[\d\s\-\(\)]{10,15}$/.test(o.value.trim())||(c(o,"Please enter a valid phone number"),e=!1):(c(o,"Contact number is required"),e=!1),m.value||(c(m,"Please select your profession"),e=!1),m.value==="salaried"&&(i.value||(c(i,"Please select your experience level"),e=!1)),Array.from(b.selectedOptions).map(a=>a.value).filter(Boolean).length===0&&(c(b,"Please select at least one service"),e=!1),r.value.trim()||(c(r,"Message is required"),e=!1),e}function x(e){e?(h.textContent="Sending...",E.classList.remove("hidden"),v.disabled=!0,n.classList.add("pointer-events-none","opacity-75")):(h.textContent="Send Message",E.classList.add("hidden"),v.disabled=!1,n.classList.remove("pointer-events-none","opacity-75"))}n.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("input",()=>d(e)),e.addEventListener("blur",()=>{e.hasAttribute("required")&&e.value.trim()&&d(e)})}),n.addEventListener("submit",async e=>{if(e.preventDefault(),!q()){y("Please fix the errors highlighted below.","error");return}x(!0),B.classList.add("hidden");try{const t=new FormData(n),s=t.getAll("services");t.delete("services"),t.append("services",s.join(", "));const o=Object.fromEntries(t),m=JSON.stringify(o),r=await fetch("https://api.web3forms.com/submit",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:m}),u=await r.json();if(r.ok&&(u.success===!0||r.status===200))y("Message sent successfully! Redirecting…","success"),B.classList.remove("hidden"),n.reset(),p.classList.add("hidden"),I(),setTimeout(()=>{if(typeof siteUrl<"u"&&siteUrl){const a=siteUrl.replace(/\/+$/,"")+"/thank-you/";window.location.href=a}},2e3);else{const a=u&&u.message?u.message:"Failed to send message. Please try again later.";y(a,"error")}}catch(t){console.error("Submission error",t),y("Network error. Please check your connection and try again.","error")}finally{x(!1)}}),document.getElementById("contact-icon-btn").onclick=function(){const e=document.getElementById("contact-modal"),t=document.getElementById("contact-modal-content");f=document.activeElement,document.body.classList.add("overflow-hidden"),e.classList.remove("hidden"),requestAnimationFrame(()=>{e.classList.add("opacity-100"),e.classList.remove("opacity-0"),t.classList.add("scale-100"),t.classList.remove("scale-95"),t.classList.remove("translate-y-full")}),document.getElementById("close-contact-btn").focus()},document.getElementById("close-contact-btn").onclick=function(){const e=document.getElementById("contact-modal"),t=document.getElementById("contact-modal-content");document.body.classList.remove("overflow-hidden"),e.classList.remove("opacity-100"),e.classList.add("opacity-0"),t.classList.remove("scale-100"),t.classList.add("scale-95"),t.classList.add("translate-y-full"),setTimeout(()=>{e.classList.add("hidden"),f&&typeof f.focus=="function"&&f.focus(),f=null},300)},document.getElementById("close-post-action").onclick=function(){document.getElementById("close-contact-btn").onclick()},document.getElementById("contact-modal").onclick=function(e){e.target===document.getElementById("contact-modal")&&document.getElementById("close-contact-btn").onclick()},document.addEventListener("keydown",function(e){e.key==="Escape"&&!document.getElementById("contact-modal").classList.contains("hidden")&&document.getElementById("close-contact-btn").onclick()})});
